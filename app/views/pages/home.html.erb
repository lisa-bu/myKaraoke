<div class="container">
  <h3 class="text-center fw-semibold fs-5 text-warning mb-2">Add songs to your session!</h3>
  <%= render "shared/search", playlist: @current_playlist %>
  <div class="stop mb-3">
    <%= link_to new_playlist_playlist_song_path(@current_playlist),
      class: "card-category card-category-recommend" do %>
      <div class="card-category-title">Get Inspired</div>
      <% end %>
    <%= link_to playlists_path,
      class: "card-category card-category-playlists" do %>
      <div class="card-category-title">Your Playlists</div>
        <% end %>
  </div>
  <div class="playlist-container head-queue">
    <div class="queue-header">
      <h2>Current karaoke session</h2>
      <% if @current_playlist.playlist_songs.any? %>
        <p>
          Now singing your <span><%= @current_playlist.name %></span> playlist
        </p>
      <% end %>
    </div>
    <% if @current_playlist.playlist_songs.count > 0 %>
      <div class="song-cards-list song-cards-list--queue">
        <% @current_playlist.playlist_songs.each_with_index do |playlist_song, index| %>
          <div class="song-card-wrapper <%= 'now-playing' if index == 0 %>"
               data-controller="song-card"
               data-song-card-playlist-song-id-value="<%= playlist_song.id %>">
            <!-- Delete button (revealed on swipe) - stays in place -->
            <button class="song-card-delete" data-action="click->song-card#confirmDelete" data-song-card-target="deleteBtn">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <!-- Stack container - both cards move together -->
            <div class="song-card-stack" data-song-card-target="stack">
              <!-- Under-layer card (lighter grey) - tap for lyrics -->
              <%= link_to song_lyrics_path(playlist_song.song),
                  data: { turbo_stream: true },
                  class: "song-card-under" do %>
                <span class="hint-left">tap to view lyrics</span>
                <span class="hint-right">‚Üê swipe to remove song</span>
              <% end %>
              <!-- Main card (darker grey) -->
              <div class="song-card" data-song-card-target="card"
                   data-controller="song-text"
                   data-action="click->song-text#toggle">
                <%= image_tag playlist_song.song.image_url, class: "song-card-image" %>
                <div class="song-card-info" data-song-text-target="info">
                  <span class="song-card-text" data-song-text-target="text"><%= playlist_song.song.name %></span>
                  <span class="song-card-text" data-song-text-target="text"><%= playlist_song.song.artist %></span>
                  <div class="flex-shrink-0">
                    <%= karaoke_availability_badges(playlist_song.song) %>
                  </div>
                </div>
                <div class="song-card-play"
                     data-controller="spotify-player"
                     data-spotify-player-uri-value="spotify:track:<%= playlist_song.song.spotify_id %>">
                  <button data-action="click->spotify-player#togglePlay"
                    data-spotify-player-target="button"
                    class="play-pause-btn">
                    <i class="fa-solid fa-play" data-spotify-player-target="icon"></i>
                  </button>
                  <div data-spotify-player-target="container" hidden></div>
                </div>
                <%# <button class="done-btn" data-action="click->song-card#confirmDelete">
                  <i class="fa-solid fa-circle-check"></i> %>
                <%# </button> %>
              </div>
            </div>
          </div>
        <% end %>
        <%# end session button - appears after last song %>
        <div class="song-card-wrapper end-session-wrapper">
          <%= link_to "End Session",
                stop_singing_user_path(current_user),
                data: { turbo_method: :patch },
                class: "btn btn-secondary w-100" %>
        </div>
      </div>
    <% else %>
      <div class="current-session d-flex justify-content-center align-items-center">
        <div class="empty-session text-center ">
          <%= image_tag "reshot-icon-note-white.svg", class: "empty-session-icon mb-3" %>

          <%# <h3 class="mb-2">Add songs to your Session</h3> %>
          <p class="mb-1">Your karaoke session is empty...</p>
          <p class="mb-3">Find for your next song at the top!</p>

          <p class="badges-copy mb-0">
            See if your song is available at
            <%= image_tag "DAM.png", class: "badge-icon-home", style: "height:20px;" %>
            <span class="badges-or">or</span>
            <%= image_tag "JOY.png", class: "badge-icon-home", style: "height:20px;" %>

          </p>
        </div>
      </div>
    <% end %>
  </div>
  <div class="mt-4" data-controller="spotify" style="display: flex; justify-content: center;">
    <% unless current_user.spotify_access_token %>
      <%= link_to '/auth/spotify',
        method: :post,
        class: "btn spotify-btn w-70 ",
        data: { action: "click->spotify#confirm" } do %>
        <i class="fa-brands fa-spotify fa-2x" style="color: green;"></i>
      <% end %>
    <% end %>
  </div>
</div>
